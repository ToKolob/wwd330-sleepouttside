import{r as y,d as L,h}from"./utils-DLQRCcCx.js";function P(a){const e=a.discount||0,t=e>0,n=a.ListPrice||a.FinalPrice||0,s=t?(n*(1-e)).toFixed(2):n.toFixed(2),o=a._searchQuery||"",r=h(a.Name||"",o),l=h(a.Brand?.Name||"",o);return`
    <li class="product-card">
      <a href="/product-detail.html?id=${a.Id}">
        <img src="${a.PrimaryMedium||"/images/default.jpg"}"
             alt="${a.Name}"
             onerror="this.src='/images/default.jpg';" />
        <h3 class="card__brand">${l}</h3>
        <h2 class="card__name">${r}</h2>
        ${t?`<p class="discount-flag">${e*100}% OFF</p>`:""}
        <p class="product-card__price">
          ${t?`<del>₹${n.toFixed(2)}</del> <strong>₹${s}</strong>`:`<strong>₹${s}</strong>`}
        </p>
      </a>
    </li>
  `}function N(){return new URLSearchParams(window.location.search).get("category")}N();class T{constructor(e,t,n,s={}){this.category=e,this.dataSource=t,this.listElement=n,this.discounts=s,this.originalList=[]}async init(){try{let e=await this.dataSource.getData(this.category);if(!e||e.length===0){this.listElement.innerHTML="<p>No products found.</p>";return}e=e.map(n=>{const s=Object.keys(this.discounts).find(o=>n.Name.toLowerCase().includes(o.toLowerCase()));return s&&(n.discount=this.discounts[s]),n}),this.originalList=[...e],this.renderList(e),this.setupSearch();const t=document.querySelector("h2");t&&(t.textContent=`Products: ${this.category||"All"}`)}catch(e){console.error("Failed to load product data:",e),this.listElement.innerHTML="<p>Error loading product list.</p>"}}renderList(e){!e||e.length===0?this.listElement.innerHTML="<p class='no-results'>No products match your search.</p>":y(P,this.listElement,e,"afterbegin",!0)}setupSearch(){const e=document.getElementById("searchInput"),t=document.getElementById("search-suggestions"),n=document.getElementById("minPrice"),s=document.getElementById("maxPrice"),o=document.querySelectorAll(".tag");let r="";const l=L(()=>{const c=e?.value?.toLowerCase().trim()||"",g=parseFloat(n?.value)||0,p=parseFloat(s?.value)||1/0,f=this.originalList.map(i=>({...i,_searchQuery:c})).filter(i=>(i.Name?.toLowerCase().includes(c)||i.Brand?.Name?.toLowerCase().includes(c)||i.NameWithoutBrand&&i.NameWithoutBrand.toLowerCase().includes(c))&&i.FinalPrice>=g&&i.FinalPrice<=p&&(!r||i.Name.toLowerCase().includes(r)));this.renderList(f),this.showSuggestions(c,e,t,l)});e?.addEventListener("input",l),n?.addEventListener("input",l),s?.addEventListener("input",l),o.forEach(c=>{c.addEventListener("click",()=>{r=c.dataset.tag.toLowerCase(),l()})})}showSuggestions(e,t,n,s){if(!e||!n)return n.innerHTML="";const o=this.originalList.filter(r=>r.Name.toLowerCase().includes(e)).slice(0,5).map(r=>`<li>${r.Name}</li>`);n.innerHTML=o.join(""),n.querySelectorAll("li").forEach(r=>{r.addEventListener("click",()=>{t.value=r.textContent,n.innerHTML="",s()})})}}const d=void 0;function m(a){if(a.ok)return a.json();throw new Error(`Bad Response: ${a.status} ${a.statusText}`)}const u=[{Id:"880RR",Name:"Ajax Tent - 3-Person, 3-Season",NameWithoutBrand:"Ajax Tent",Brand:{Name:"Marmot"},ListPrice:199.99,FinalPrice:199.99,Category:"Tents",PrimaryMedium:"images/tents/marmot-ajax-tent-3-person-3-season-in-pale-pumpkin-terracotta~p~880rr_01~320.jpg"},{Id:"985RF",Name:"Talus Tent - 4-Person, 3-Season",NameWithoutBrand:"Talus Tent",Brand:{Name:"The North Face"},ListPrice:199.99,FinalPrice:199.99,Category:"Tents",PrimaryMedium:"images/tents/the-north-face-talus-tent-4-person-3-season-in-golden-oak-saffron-yellow~p~985rf_01~320.jpg"},{Id:"985PR",Name:"Alpine Guide Tent - 3-Person, 4-Season",NameWithoutBrand:"Alpine Guide Tent",Brand:{Name:"The North Face"},ListPrice:349.99,FinalPrice:349.99,Category:"Tents",PrimaryMedium:"images/tents/the-north-face-alpine-guide-tent-3-person-4-season-in-canary-yellow-high-rise-grey~p~985pr_01~320.jpg"},{Id:"344YJ",Name:"Rimrock Tent - 2-Person, 3-Season",NameWithoutBrand:"Rimrock Tent",Brand:{Name:"Cedar Ridge"},ListPrice:69.99,FinalPrice:69.99,Category:"Tents",PrimaryMedium:"images/tents/cedar-ridge-rimrock-tent-2-person-3-season-in-rust-clay~p~344yj_01~320.jpg"}];class ${constructor(e=!1){this.useMock=e}async getData(e=null){if(this.useMock)return e?u.filter(t=>t.Category?.toLowerCase()===e.toLowerCase()):u;try{const t=e?`${d}products/search/${e}`:`${d}products`,n=await fetch(t);return(await m(n)).Result}catch(t){throw console.error(`Failed to fetch product list${e?` for category: ${e}`:""}`,t),t}}async findProductById(e){if(this.useMock)return u.find(t=>t.Id===e)||null;try{const t=await fetch(`${d}product/${e}`);return(await m(t)).Result}catch(t){throw console.error(`Failed to fetch product by ID: ${e}`,t),t}}}export{$ as P,T as a};
