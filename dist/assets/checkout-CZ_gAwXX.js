import{a as n,s as l}from"./utils-Dn5CXOys.js";import{E as h}from"./ExternalServices-BYvN3tU5.js";const u=new h;function m(s){const e=new FormData(s),t={};return e.forEach((o,r)=>{t[r]=o}),t}function d(s){return s.map(e=>({id:e.Id,name:e.Name,price:e.FinalPrice,quantity:e.quantity||1}))}class p{constructor(e,t){this.key=e,this.outputSelector=t,this.list=[],this.itemTotal=0,this.shipping=0,this.tax=0,this.orderTotal=0}init(){this.list=n(this.key)||[],this.renderCartItems(),this.calculateItemSummary(),this.calculateOrderTotal()}renderCartItems(){const e=document.querySelector(this.outputSelector+" .checkout-cart");e&&(e.innerHTML="",this.list.forEach(t=>{const o=document.createElement("div");o.classList.add("checkout-item"),o.innerHTML=`
        <span class="item-name">${t.Name}</span>
        <span class="item-qty">Qty: ${t.quantity||1}</span>
        <span class="item-price">₹${t.FinalPrice.toFixed(2)}</span>
        <span class="item-subtotal">Subtotal: ₹${(t.FinalPrice*(t.quantity||1)).toFixed(2)}</span>
      `,e.appendChild(o)}))}calculateItemSummary(){const e=document.querySelector(this.outputSelector+" #cartTotal"),t=document.querySelector(this.outputSelector+" #num-items"),o=this.list.reduce((i,a)=>i+(a.quantity||1),0);t.innerText=o;const r=this.list.map(i=>i.FinalPrice*(i.quantity||1));this.itemTotal=r.reduce((i,a)=>i+a,0),e.innerText=`₹${this.itemTotal.toFixed(2)}`}calculateOrderTotal(){this.tax=this.itemTotal*.06,this.shipping=10+(this.list.length-1)*2,this.orderTotal=parseFloat(this.itemTotal+this.tax+this.shipping),this.displayOrderTotals()}displayOrderTotals(){const e=document.querySelector(`${this.outputSelector} #tax`),t=document.querySelector(`${this.outputSelector} #shipping`),o=document.querySelector(`${this.outputSelector} #orderTotal`);e.innerText=`₹${this.tax.toFixed(2)}`,t.innerText=`₹${this.shipping.toFixed(2)}`,o.innerText=`₹${this.orderTotal.toFixed(2)}`}async checkout(){const e=document.forms.checkout,t=m(e);t.orderDate=new Date().toISOString(),t.orderTotal=this.orderTotal,t.tax=this.tax,t.shipping=this.shipping,t.items=d(this.list);try{const o=await u.checkout(t);console.log(o),alert("Order placed successfully!"),localStorage.removeItem(this.key),this.list=[],localStorage.removeItem(this.key),l(this.key,this.list),this.renderCartItems(),this.calculateItemSummary(),this.calculateOrderTotal(),window.location.pathname.includes("cart.html")&&window.location.reload(),window.location.href="/index.html"}catch(o){console.error("Checkout failed:",o)}}}const c=new p("so-cart",".checkout-summary");c.init();document.querySelector("#place-order-btn").addEventListener("click",()=>{confirm("Confirm placing your order?")&&c.checkout()});
